.include "address_map_arm.s"

.text /* executable code follows */
.global _start

_start:
LDR R1, =KEY_BASE
LDR R2, =JP1_BASE
LDR R3, =LOOKUP

LDR R4, =0xFFFFFFFF
STR R4, [R2, #4]

MOV R5, #0
AND R7, R5, #0xF0
LSR R7, #4
AND R8, R5, #0x0F

LDR R9, [R3, R7, LSL #2]
LDR R10, [R3, R8, LSL #2]
LSL R10, #8

ADD R11, R10, R9
STR R11, [R2]

CHECK:
LDR R6, [R1]
CMP R6, #1
BLT CHECK

ADD_ONE:
ADD R5, #1
CMP R5, #256
MOVEQ R5, #0

AND R7, R5, #0xF0
LSR R7, #4
AND R8, R5, #0x0F

LDR R9, [R3, R7, LSL #2]
LDR R10, [R3, R8, LSL #2]
LSL R10, #8

ORR R11, R9, R10
STR R11, [R2]

WAIT:
LDR R6, [R1]
CMP R6, #0
BNE WAIT
BEQ CHECK

LOOKUP:
.word 0b11000000, 0b11001111, 0b10010010, 0b10000110
.word 0b10001101, 0b10100100, 0b10100000, 0b11001110
.word 0b10000000, 0b10000100, 0b10001000, 0b10100001 
.word 0b10110011, 0b10000011, 0b10110000, 0b10111000